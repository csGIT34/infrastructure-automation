# Pattern: api-backend
# REST API backend with database

name: api-backend
description: |
  Function App API backend with database (PostgreSQL, SQL, or MongoDB) and
  Key Vault integration. For microservice backends and REST APIs.

category: composite
components:
  - function-app
  - postgresql/azure_sql/mongodb (selectable)
  - keyvault
  - security-groups
  - rbac-assignments
  - diagnostic-settings (staging/prod)

use_cases:
  - Microservice APIs
  - REST API backends
  - GraphQL servers
  - BFF (Backend for Frontend)

sizing:
  small:
    dev:
      function_sku: FC1  # Flex Consumption - no VM quota required
      db_sku: Free
      enable_diagnostics: false
    staging:
      function_sku: Y1
      db_sku: Basic
      enable_diagnostics: true
    prod:
      function_sku: B1
      db_sku: S0
      enable_diagnostics: true

  medium:
    dev:
      function_sku: Y1
      db_sku: Basic
      enable_diagnostics: false
    staging:
      function_sku: B1
      db_sku: S1
      enable_diagnostics: true
    prod:
      function_sku: S1
      db_sku: S2
      enable_diagnostics: true

  large:
    dev:
      function_sku: B1
      db_sku: S0
      enable_diagnostics: true
    staging:
      function_sku: S1
      db_sku: S2
      enable_diagnostics: true
    prod:
      function_sku: P1v2
      db_sku: S3
      enable_diagnostics: true

config:
  required:
    - name
  optional:
    - database_type:
        type: string
        default: azure_sql
        enum: [azure_sql, postgresql, mongodb, none]
    - runtime:
        type: string
        default: python
        enum: [python, node, dotnet, java]
    - runtime_version:
        type: string

estimated_costs:
  small:
    dev: 30
    staging: 65
    prod: 260
  medium:
    dev: 55
    staging: 260
    prod: 475
  large:
    dev: 260
    staging: 475
    prod: 950
