# Pattern: mongodb
# Azure Cosmos DB with MongoDB API

name: mongodb
description: |
  Azure Cosmos DB with MongoDB API for document database workloads.
  Connection strings stored in Key Vault with security group-based access.
  Supports automatic failover and configurable consistency levels.

category: single-resource
components:
  - mongodb
  - keyvault
  - security-groups
  - rbac-assignments
  - diagnostic-settings (staging/prod)
  - access-review (prod only)

use_cases:
  - Document databases
  - Content management systems
  - User profile storage
  - Catalog data
  - Mobile app backends

# T-shirt sizing matrix
sizing:
  small:
    dev:
      throughput: 400
      max_throughput: 1000
      enable_automatic_failover: false
      consistency_level: Session
      enable_diagnostics: false
      enable_access_review: false
    staging:
      throughput: 400
      max_throughput: 4000
      enable_automatic_failover: false
      consistency_level: Session
      enable_diagnostics: true
      enable_access_review: false
    prod:
      throughput: 1000
      max_throughput: 10000
      enable_automatic_failover: true
      consistency_level: Strong
      enable_diagnostics: true
      enable_access_review: true

  medium:
    dev:
      throughput: 1000
      max_throughput: 4000
      enable_automatic_failover: false
      consistency_level: Session
      enable_diagnostics: false
      enable_access_review: false
    staging:
      throughput: 2000
      max_throughput: 10000
      enable_automatic_failover: true
      consistency_level: BoundedStaleness
      enable_diagnostics: true
      enable_access_review: false
    prod:
      throughput: 4000
      max_throughput: 20000
      enable_automatic_failover: true
      consistency_level: Strong
      enable_diagnostics: true
      enable_access_review: true

  large:
    dev:
      throughput: 4000
      max_throughput: 10000
      enable_automatic_failover: true
      consistency_level: BoundedStaleness
      enable_diagnostics: true
      enable_access_review: false
    staging:
      throughput: 10000
      max_throughput: 50000
      enable_automatic_failover: true
      consistency_level: Strong
      enable_diagnostics: true
      enable_access_review: true
    prod:
      throughput: 20000
      max_throughput: 100000
      enable_automatic_failover: true
      consistency_level: Strong
      enable_diagnostics: true
      enable_access_review: true

# Configuration schema
config:
  required:
    - name
  optional:
    - consistency_level:
        type: string
        default: Session
        enum: ["Eventual", "Session", "BoundedStaleness", "Strong"]
        description: Consistency level for reads
    - enable_automatic_failover:
        type: boolean
        default: false
        description: Enable automatic failover to secondary region
    - enable_private_endpoint:
        type: boolean
        default: false
        description: Enable private endpoint connectivity
    - subnet_id:
        type: string
        description: Subnet ID for private endpoint

# Estimated costs (USD/month) - based on RU/s throughput
estimated_costs:
  small:
    dev: 25
    staging: 50
    prod: 150
  medium:
    dev: 60
    staging: 150
    prod: 300
  large:
    dev: 150
    staging: 400
    prod: 800

example:
  version: "1"
  metadata:
    project: myapp
    environment: dev
    business_unit: engineering
    owners:
      - alice@example.com
    location: eastus
  pattern: mongodb
  config:
    name: appdata
    size: small
    consistency_level: Session
