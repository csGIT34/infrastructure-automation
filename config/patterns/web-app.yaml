# Pattern: web-app
# Complete web application: Static frontend + Function backend + Database

name: web-app
description: |
  Full-stack web application pattern with static frontend, serverless API backend,
  and database. Includes managed identity, Key Vault integration, and security groups.

category: composite
components:
  - static-web-app (frontend)
  - function-app (API backend)
  - postgresql/azure_sql (database, optional)
  - keyvault (shared secrets)
  - security-groups
  - rbac-assignments
  - diagnostic-settings (staging/prod)

use_cases:
  - Single-page applications (SPAs)
  - JAMstack applications
  - Admin dashboards
  - Customer portals
  - Internal tools

# T-shirt sizing matrix
sizing:
  small:
    dev:
      swa_sku_tier: Free
      function_sku: Y1
      db_sku: B_Standard_B1ms
      enable_diagnostics: false
    staging:
      swa_sku_tier: Free
      function_sku: Y1
      db_sku: B_Standard_B1ms
      enable_diagnostics: true
    prod:
      swa_sku_tier: Standard
      function_sku: B1
      db_sku: GP_Standard_D2s_v3
      enable_diagnostics: true

  medium:
    dev:
      swa_sku_tier: Free
      function_sku: Y1
      db_sku: B_Standard_B2s
      enable_diagnostics: false
    staging:
      swa_sku_tier: Standard
      function_sku: B1
      db_sku: GP_Standard_D2s_v3
      enable_diagnostics: true
    prod:
      swa_sku_tier: Standard
      function_sku: S1
      db_sku: GP_Standard_D4s_v3
      enable_diagnostics: true

  large:
    dev:
      swa_sku_tier: Standard
      function_sku: B1
      db_sku: GP_Standard_D2s_v3
      enable_diagnostics: true
    staging:
      swa_sku_tier: Standard
      function_sku: S1
      db_sku: GP_Standard_D4s_v3
      enable_diagnostics: true
    prod:
      swa_sku_tier: Standard
      function_sku: P1v2
      db_sku: GP_Standard_D8s_v3
      enable_diagnostics: true

# Configuration schema
config:
  required:
    - name
  optional:
    - database_type:
        type: string
        default: postgresql
        enum: [postgresql, azure_sql, none]
        description: Database type (or none for frontend-only)
    - runtime:
        type: string
        default: python
        enum: [python, node, dotnet, java]
        description: API backend runtime
    - runtime_version:
        type: string
        description: Runtime version (e.g., 3.11 for Python)

# Excludable components
excludable:
  - database:
      description: Deploy without database (frontend + API only)
      cost_impact: ~$25-400/month depending on size
  - diagnostics:
      description: Disable diagnostic logs
      cost_impact: ~$30/month

# Estimated costs (USD/month)
estimated_costs:
  small:
    dev: 35
    staging: 80
    prod: 300
  medium:
    dev: 60
    staging: 250
    prod: 550
  large:
    dev: 250
    staging: 550
    prod: 1100

example:
  version: "1"
  metadata:
    project: customer-portal
    environment: dev
    business_unit: product
    owners:
      - alice@example.com
      - bob@example.com
  pattern: web-app
  config:
    name: portal
    size: small
    database_type: postgresql
    runtime: python
