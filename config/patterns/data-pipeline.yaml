# Pattern: data-pipeline
# Event-driven data processing pipeline

name: data-pipeline
description: |
  Complete data pipeline with Event Hub ingestion, Function App processing,
  Data Lake storage, and optional Cosmos DB for processed data.

category: composite
components:
  - eventhub (ingestion)
  - function-app (processor)
  - storage-account (data lake)
  - mongodb (processed data, optional)
  - keyvault (secrets)
  - security-groups
  - rbac-assignments
  - diagnostic-settings (staging/prod)

use_cases:
  - IoT data ingestion
  - Event streaming
  - Log aggregation
  - Real-time analytics
  - ETL pipelines

sizing:
  small:
    dev:
      eventhub_sku: Basic
      eventhub_capacity: 1
      function_sku: Y1
      storage_replication: LRS
      partition_count: 2
      enable_diagnostics: false
    staging:
      eventhub_sku: Basic
      eventhub_capacity: 1
      function_sku: Y1
      storage_replication: LRS
      partition_count: 4
      enable_diagnostics: true
    prod:
      eventhub_sku: Standard
      eventhub_capacity: 2
      function_sku: B1
      storage_replication: GRS
      partition_count: 8
      enable_diagnostics: true

  medium:
    dev:
      eventhub_sku: Basic
      eventhub_capacity: 1
      function_sku: Y1
      storage_replication: LRS
      partition_count: 4
      enable_diagnostics: false
    staging:
      eventhub_sku: Standard
      eventhub_capacity: 2
      function_sku: B1
      storage_replication: GRS
      partition_count: 8
      enable_diagnostics: true
    prod:
      eventhub_sku: Standard
      eventhub_capacity: 4
      function_sku: S1
      storage_replication: RAGRS
      partition_count: 16
      enable_diagnostics: true

  large:
    dev:
      eventhub_sku: Standard
      eventhub_capacity: 2
      function_sku: B1
      storage_replication: GRS
      partition_count: 8
      enable_diagnostics: true
    staging:
      eventhub_sku: Standard
      eventhub_capacity: 4
      function_sku: S1
      storage_replication: RAGRS
      partition_count: 16
      enable_diagnostics: true
    prod:
      eventhub_sku: Standard
      eventhub_capacity: 8
      function_sku: P1v2
      storage_replication: RAGRS
      partition_count: 32
      enable_diagnostics: true

config:
  required:
    - name
  optional:
    - runtime:
        type: string
        default: python
    - enable_mongodb:
        type: boolean
        default: true
        description: Include Cosmos DB for processed data
    - message_retention:
        type: number
        default: 1
        description: Event Hub message retention in days

excludable:
  - mongodb:
      description: Deploy without Cosmos DB (storage only)
      cost_impact: ~$25-100/month

estimated_costs:
  small:
    dev: 30
    staging: 80
    prod: 250
  medium:
    dev: 60
    staging: 250
    prod: 500
  large:
    dev: 250
    staging: 500
    prod: 1000
