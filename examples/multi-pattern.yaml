# Multi-Pattern Infrastructure Request Example
#
# This file demonstrates how to provision multiple patterns in a single request
# using YAML multi-document format (documents separated by ---).
#
# Key features:
# - Use 'action: create' (default) to provision new resources
# - Use 'action: destroy' to tear down existing resources
# - Destroy actions are executed FIRST, then create actions
# - Each document is processed sequentially
# - Partial failures are reported (remaining patterns still process)
# - pattern_version is REQUIRED for all patterns (version pinning)
#
# Use case: Replacing an old database with a new one
# 1. Destroy the old PostgreSQL database
# 2. Create a new Key Vault for secrets
# 3. Create a new storage account for data

# Document 0: Destroy old PostgreSQL database
---
version: "1"
action: destroy
metadata:
  project: myapp
  environment: dev
  business_unit: engineering
  owners:
    - alice@company.com
    - bob@company.com
  location: eastus

pattern: postgresql
pattern_version: "1.0.0"              # Version that was used to create the resource
config:
  name: olddb
  version: "14"                       # PostgreSQL version

# Document 1: Create new Key Vault for secrets
---
version: "1"
action: create  # Optional - 'create' is the default
metadata:
  project: myapp
  environment: dev
  business_unit: engineering
  owners:
    - alice@company.com
    - bob@company.com
  location: eastus

pattern: keyvault
pattern_version: "1.0.0"              # Pin to specific version
config:
  name: secrets
  size: small
  enable_access_review: false         # Enable quarterly access reviews

# Document 2: Create new storage account
---
version: "1"
metadata:
  project: myapp
  environment: dev
  business_unit: engineering
  owners:
    - alice@company.com
    - bob@company.com
  location: eastus

pattern: storage
pattern_version: "1.0.0"              # Pin to specific version
config:
  name: data
  size: small
  containers:
    - uploads
    - backups
